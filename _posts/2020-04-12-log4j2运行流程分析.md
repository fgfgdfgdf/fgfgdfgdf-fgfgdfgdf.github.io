---
layout: post
title: log4j2运行流程分析
---


## log4j2日志记录过程分析


### 例一
#### 配置
```xml
<!--最简单的控制台输出配置 -->
<configuration>
    <appenders>
        <Console name="ConsoleLog" target="SYSTEM_OUT">
            <PatternLayout pattern="[%d{yyyy-MM-dd HH:mm:ss:SSS} %p] [%thread] (%F:%L) %m%n"/>
        </Console>
    </appenders>

    <loggers>
        <root level="INFO">
            <AppenderRef ref="ConsoleLog"/>
        </root>
    </loggers>
</configuration>
```
#### 代码
```java
package com.sample;

import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

public class Main {

    public static final Logger log1 = LoggerFactory.getLogger(Main.class); // 1

    public static void main(String[] args) {
        log1.info("this is log1 msg...");// 2
    }
}
```
#### 分析
log4j2使用方式无非两步,逐步分析
1) 使用LoggerFactory获取到对应Logger
2) 调用Logger对应方法

##### 使用LoggerFactory获取到对应Logger


```java
    // LoggerFactory类由slf4j提供,该类对外提供三个public方法
    // 1:通过3找到实现类,调用实现类的 `public Logger getLogger(String name)`方法
    public static Logger getLogger(String name)
    // 2:间接调用方法1
    public static Logger getLogger(Class<?> clazz)
    // 3:获取实现ILoggerFactory接口的类,这里是log4j2中的`Log4jLoggerFactory`
    public static ILoggerFactory getILoggerFactory()

    // 分析1:通过slf4j提供的接口方法,调用log4j2对slf4j的实现方法,
    // 此步骤在slf4j层面
```

```java
    // Log4jLoggerFactory对ILoggerFactory接口的实现方法
    public L getLogger(final String name) {
        final LoggerContext context = getContext();
        final ConcurrentMap<String, L> loggers = getLoggersInContext(context);
        final L logger = loggers.get(name);
        if (logger != null) {
            return logger;
        }
        loggers.putIfAbsent(name, newLogger(name, context));
        return loggers.get(name);
    }
    

```



























##### 调用Logger对应方法
